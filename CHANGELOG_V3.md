# üìù Changelog v3.0

## [3.0.0] - 2026-02-25

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **app/config.py**: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (`db_pool_size`, `db_max_overflow`, `db_pool_timeout`, `db_pool_recycle`)
- **app/db/base.py**: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è SQLite/PostgreSQL, connection pooling, `pool_pre_ping`
- **app/db/models.py**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, `lazy="selectin"` –∏ `lazy="joined"` –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
- **requirements.txt**: –î–æ–±–∞–≤–ª–µ–Ω `asyncpg>=0.29.0`
- **scripts/migrate_to_postgres.py**: –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å SQLite –Ω–∞ PostgreSQL

#### WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **app/webapp/app.py**: 
  - `ConnectionManager` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
  - `WebSocket endpoint /ws/admin`
  - `send_booking_update()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `SimpleCache`
- **app/webapp/static/admin.js**: 
  - `connectWebSocket()` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –∫–∞–ª–µ–Ω–¥–∞—Ä—è, –¥–∞—à–±–æ—Ä–¥–∞
  - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- **app/webapp/static/admin.css**: –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### –†–∞—Å—Å—ã–ª–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞–º
- **app/db/models.py**: –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `Subscriber`
- **app/db/crud.py**: 
  - `add_subscriber()` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
  - `get_active_subscribers()` - –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö
  - `get_subscribers_count()` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  - `update_last_mailed()` - –æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏
- **app/bot/handlers/common.py**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–∏ `/start`
- **app/bot/handlers/admin.py**: 
  - `/broadcast` - –Ω–∞—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
  - `/subscribers` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - `/cancel` - –æ—Ç–º–µ–Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

#### Connection Pooling
```python
engine = create_async_engine(
    settings.db_url,
    pool_size=settings.db_pool_size,
    max_overflow=settings.db_max_overflow,
    pool_timeout=settings.db_pool_timeout,
    pool_recycle=settings.db_pool_recycle,
    pool_pre_ping=True,
)
```

#### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **app/webapp/app.py**: `SimpleCache` —Å TTL 30 —Å–µ–∫—É–Ω–¥
- –ö—ç—à–∏—Ä—É—é—Ç—Å—è: `/api/bootstrap`, `/api/availability`, `/api/tables_status`

#### SQL –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **app/db/crud.py**: 
  - –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
  - `selectinload` –∏ `joinedload` –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - `func.count`, `func.sum`, `func.case` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### Lazy Loading
- **app/db/models.py**: 
  - `lazy="selectin"` –¥–ª—è `Client.bookings`, `Client.reviews`
  - `lazy="joined"` –¥–ª—è `Booking.client`, `Booking.review`

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- **OPTIMIZATIONS_V3.md**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- **UPGRADE_TO_V3.md**: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é
- **CHANGELOG_V3.md**: –≠—Ç–æ—Ç —Ñ–∞–π–ª

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **README.md**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å v3.0 —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- **.env.example**: –î–æ–±–∞–≤–ª–µ–Ω—ã PostgreSQL –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### app/webapp/app.py
- –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è Pydantic –º–æ–¥–µ–ª–∏
- –î–æ–±–∞–≤–ª–µ–Ω `WebSocket Manager`
- –î–æ–±–∞–≤–ª–µ–Ω `SimpleCache`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã endpoint'—ã
- –î–æ–±–∞–≤–ª–µ–Ω `Broadcast API`
- –û–±–Ω–æ–≤–ª–µ–Ω `on_shutdown()` —Å `dispose_engine()`

#### app/bot/handlers/admin.py
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã: `/broadcast`, `/subscribers`, `/cancel`
- –î–æ–±–∞–≤–ª–µ–Ω `_broadcast_state` –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏

#### app/bot/handlers/common.py
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–∏ `/start`
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (v2.0) | –ü–æ—Å–ª–µ (v3.0) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------|--------------|-----------|
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API | ~200ms | ~50ms | 4x |
| –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π | 1-5 | 50+ | 10x |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∫–∏ | Polling 5s | WebSocket | Real-time |
| –†–∞—Å—Å—ã–ª–∫–∏ | ‚ùå –ù–µ—Ç | ‚úÖ 1000/–º–∏–Ω | –ù–æ–≤–æ–µ |

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

- ‚úÖ PostgreSQL —Å ACID
- ‚úÖ Connection pooling –¥–ª—è Render
- ‚úÖ WebSocket —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –†–∞—Å—Å—ã–ª–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞–º
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## [2.0.0] - 2026-02-23

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è Pydantic
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## [1.0.0] - 2026-02-22

### –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑
- –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞
- Web App –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –±—Ä–æ–Ω—è—Ö
